#!/bin/sh
echo "DEBUG ENV: ${TRAVIS_JOB_NUMBER} ${TRAVIS_BUILD_NUMBER} ..."

if [ "${TRAVIS_BUILD_NUMBER}.1" != "${TRAVIS_JOB_NUMBER}" ]; then
  echo "Only push documents 1 time... quot."
  exit 0
fi

build/gen_doc
cd build/result/docs/

if [ "${TRAVIS_BRANCH}" != "master" ]; then
  cd ..
  git init
  git pull git@github.com:zordius/lightncandy gh-pages:master
  rm -rf $TRAVIS_BRANCH
  mv doc $TRAVIS_BRANCH
  git add $TRAVIS_BRANCH
else  
  git init
  git add .
fi

git config user.name "Travis-CI"
git config user.email "zordius@yahoo-inc.com"

git commit -m "Auto deployed to Github Pages from branch ${TRAVIS_BRANCH} @${TRAVIS_COMMIT}"
git push --force --quiet "https://${GHTK}@github.com/zordius/lightncandy.git" master:gh-pages > /dev/null 2>&1
